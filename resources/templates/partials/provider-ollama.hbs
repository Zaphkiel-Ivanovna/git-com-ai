<div id="ollama-section" class="model-section card {{#if isOllamaSelected}}active{{/if}}">
    <div class="card-header">
        <svg class="card-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6.91845 0.00674475C6.69641 0.0429311 6.42995 0.160105 6.24206 0.304851C5.67328 0.740809 5.23259 1.66615 5.04641 2.81893C4.97638 3.25489 4.92856 3.85973 4.92856 4.32154C4.92856 4.86606 4.99176 5.5622 5.08228 6.04296C5.10278 6.1498 5.11303 6.24459 5.10449 6.25148C5.09766 6.25836 5.01396 6.32729 4.92001 6.4031C4.5989 6.66157 4.23166 7.05963 3.97887 7.42323C3.49377 8.11766 3.17948 8.90687 3.04796 9.76155C2.99672 10.0993 2.98306 10.7817 3.02405 11.1194C3.11458 11.8983 3.34688 12.5565 3.74486 13.1596L3.87467 13.3543L3.83709 13.4181C3.57063 13.8696 3.34346 14.5226 3.23756 15.1499C3.15386 15.6461 3.14362 15.7788 3.14362 16.4439C3.14362 17.1143 3.15216 17.247 3.23073 17.7105C3.32467 18.2653 3.51598 18.8529 3.72948 19.2441C3.79952 19.3716 3.97033 19.637 3.99082 19.6508C3.99765 19.6542 3.97716 19.718 3.9447 19.792C3.69874 20.3348 3.48865 21.0568 3.40153 21.6651C3.34004 22.0821 3.3315 22.2165 3.3315 22.656C3.3315 23.216 3.36225 23.4882 3.4784 23.9345L3.49548 24H4.9593L4.91147 23.9087C4.61598 23.3573 4.58865 22.3337 4.84315 21.3119C4.9593 20.8397 5.09083 20.4934 5.33679 20.0161L5.48368 19.7266V19.5491C5.48368 19.3837 5.48027 19.3647 5.42732 19.2562C5.38632 19.1734 5.33166 19.1028 5.2343 19.0063C5.06862 18.8443 4.94905 18.6737 4.8534 18.4635C4.43322 17.5433 4.35123 16.1769 4.64672 15.012C4.76971 14.5261 4.97297 14.0936 5.18648 13.8575C5.33166 13.6955 5.40682 13.5146 5.40682 13.3268C5.40682 13.1321 5.33849 12.9718 5.18477 12.8047C4.74408 12.3291 4.4725 11.7501 4.37514 11.0763C4.23678 10.1165 4.48787 9.07055 5.05837 8.24173C5.61691 7.42838 6.40091 6.90627 7.27717 6.7667C7.47358 6.73395 7.84083 6.73913 8.04579 6.77705C8.26957 6.81668 8.40961 6.80459 8.55311 6.73567C8.73074 6.65126 8.81957 6.54612 8.92375 6.30489C9.01598 6.08951 9.08773 5.97232 9.28075 5.72937C9.51305 5.43815 9.73679 5.23997 10.0955 5.00045C10.5054 4.72992 10.9717 4.53349 11.4363 4.43871C11.6054 4.40424 11.684 4.39907 12 4.39907C12.316 4.39907 12.3946 4.40424 12.5637 4.43871C13.2452 4.5783 13.9216 4.93327 14.4613 5.43641C14.5775 5.54497 14.8559 5.89305 14.9447 6.03782C14.9789 6.09465 15.0387 6.2153 15.0762 6.30489C15.1804 6.54612 15.2693 6.65126 15.4469 6.73567C15.5853 6.80288 15.7304 6.81668 15.9456 6.78048C16.2856 6.7219 16.5469 6.72707 16.88 6.79599C18.0141 7.02689 19.0014 7.96946 19.4387 9.23255C19.8196 10.3405 19.712 11.5002 19.1449 12.3859C19.0492 12.5358 18.9536 12.6565 18.8152 12.8047C18.5163 13.1269 18.5163 13.5267 18.8135 13.8575C19.302 14.3969 19.6078 15.7237 19.5155 16.8937C19.4541 17.6657 19.2576 18.3567 18.9877 18.7478C18.9399 18.8168 18.8409 18.9339 18.7657 19.0063C18.6683 19.1028 18.6137 19.1734 18.5727 19.2562C18.5197 19.3647 18.5163 19.3837 18.5163 19.5491V19.7266L18.6632 20.0161C18.9092 20.4934 19.0407 20.8397 19.1568 21.3119C19.4079 22.3199 19.3857 23.3228 19.0988 23.8932C19.0749 23.9414 19.0544 23.9862 19.0544 23.9914C19.0544 23.9966 19.3806 24 19.7803 24H20.5045L20.5233 23.9259C20.5336 23.8863 20.5506 23.826 20.5592 23.7915C20.578 23.7157 20.6155 23.4917 20.6463 23.2763C20.6753 23.0592 20.6753 22.2596 20.6463 22.0184C20.537 21.143 20.3542 20.4486 20.0553 19.792C20.0228 19.718 20.0023 19.6542 20.0092 19.6508C20.0177 19.6456 20.0655 19.5767 20.1168 19.4991C20.4891 18.9305 20.718 18.2154 20.8342 17.2711C20.8649 17.0109 20.8649 15.8925 20.8342 15.6427C20.7522 14.9982 20.6531 14.5605 20.4891 14.1177C20.4208 13.9333 20.2398 13.5439 20.1629 13.4181L20.1253 13.3543L20.2551 13.1596C20.6531 12.5565 20.8854 11.8983 20.976 11.1194C21.0169 10.7817 21.0033 10.0993 20.952 9.76155C20.8188 8.90513 20.5062 8.11937 20.0211 7.42323C19.7683 7.05963 19.4011 6.66157 19.08 6.4031C18.986 6.32729 18.9023 6.25836 18.8955 6.25148C18.887 6.24459 18.8972 6.1498 18.9177 6.04296C19.1244 4.95564 19.1175 3.59954 18.9006 2.53979C18.7127 1.61618 18.3711 0.882108 17.9304 0.458212C17.5786 0.120473 17.2199 -0.0242726 16.7894 0.00329796C15.8022 0.0618852 15.0062 1.20779 14.6919 3.01365C14.6407 3.30487 14.5963 3.64607 14.5963 3.73911C14.5963 3.77529 14.5894 3.80458 14.5809 3.80458C14.5724 3.80458 14.5058 3.77011 14.434 3.72705C13.6722 3.27212 12.825 3.02917 12 3.02917C11.175 3.02917 10.3278 3.27212 9.56599 3.72705C9.49424 3.77011 9.42764 3.80458 9.41909 3.80458C9.41056 3.80458 9.40371 3.77529 9.40371 3.73911C9.40371 3.64261 9.35759 3.29109 9.30808 3.01365C9.02281 1.39216 8.36862 0.318636 7.49922 0.0480996C7.37966 0.0119133 7.03975 -0.01221 6.91845 0.00674475ZM7.20885 1.4094C7.4548 1.60584 7.72809 2.16759 7.88524 2.79654C7.91428 2.91026 7.94501 3.04123 7.95357 3.08946C7.96039 3.13601 7.97917 3.24112 7.99455 3.3221C8.06118 3.68741 8.09191 4.08202 8.09534 4.56278L8.09704 5.03666L7.97917 5.2124L7.86134 5.38988H7.58632C7.26522 5.38988 6.94579 5.43126 6.64004 5.51396C6.53073 5.54154 6.42482 5.56911 6.40434 5.57428C6.37188 5.58117 6.36675 5.57083 6.34797 5.42952C6.24719 4.66271 6.25232 3.81321 6.36335 3.10669C6.48632 2.31922 6.77328 1.60584 7.0534 1.39561C7.12002 1.34564 7.13197 1.34736 7.20885 1.4094ZM16.9483 1.39733C17.1174 1.52312 17.3036 1.85742 17.4419 2.28476C17.7203 3.13944 17.7989 4.31291 17.652 5.42952C17.6332 5.57083 17.6281 5.58117 17.5957 5.57428C17.5752 5.56911 17.4693 5.54154 17.36 5.51396C17.0542 5.43126 16.7348 5.38988 16.4137 5.38988H16.1387L16.0208 5.2124L15.903 5.03666L15.9047 4.56278C15.9081 3.89419 15.9696 3.37208 16.1165 2.79137C16.2719 2.16759 16.5469 1.60584 16.7911 1.4094C16.868 1.34736 16.88 1.34564 16.9483 1.39733Z" fill="currentColor"/>
            <path d="M11.7352 10.07C11.3646 10.1062 11.2638 10.1199 11.0862 10.1562C10.7975 10.2164 10.4115 10.3509 10.1433 10.4835C9.2107 10.9436 8.56846 11.7104 8.37202 12.5979C8.33274 12.7736 8.32761 12.8322 8.32761 13.1286C8.32761 13.4215 8.33274 13.4853 8.37032 13.6524C8.63166 14.8121 9.69065 15.6685 11.0605 15.8253C11.3577 15.8581 12.6422 15.8581 12.9394 15.8253C14.0394 15.6995 14.9857 15.0982 15.411 14.2538C15.5237 14.0281 15.5784 13.8816 15.6296 13.6524C15.6672 13.4853 15.6724 13.4215 15.6724 13.1286C15.6724 12.8322 15.6672 12.7736 15.6279 12.5979C15.3427 11.3089 14.1026 10.294 12.5824 10.101C12.3843 10.0769 11.8651 10.0562 11.7352 10.07ZM12.374 11.0074C12.8814 11.0625 13.3921 11.2452 13.802 11.5209C14.0224 11.6691 14.3332 11.9792 14.4664 12.1826C14.6304 12.4341 14.7244 12.6909 14.7671 13.0028C14.7858 13.1458 14.7756 13.2544 14.7244 13.4853C14.6441 13.8299 14.3947 14.19 14.0582 14.4416C13.9011 14.5571 13.5748 14.7242 13.375 14.7897C12.9958 14.912 12.7481 14.9345 11.8633 14.9276C11.286 14.9224 11.1835 14.9172 11.0178 14.8862C10.4525 14.7794 10.005 14.5519 9.68042 14.2056C9.41736 13.9264 9.2978 13.6714 9.2329 13.2596C9.20387 13.0683 9.25851 12.7512 9.36955 12.4841C9.50449 12.1584 9.85293 11.7535 10.198 11.5209C10.5976 11.2521 11.1237 11.0608 11.6071 11.0091C11.7933 10.9884 12.1879 10.9884 12.374 11.0074Z" fill="currentColor"/>
            <path d="M11.3475 12.2653C11.2177 12.336 11.1272 12.5152 11.1545 12.6478C11.1853 12.7909 11.31 12.9356 11.5047 13.0545C11.6089 13.1183 11.6157 13.1269 11.6208 13.1906C11.6242 13.2286 11.6106 13.3371 11.5918 13.4336C11.5713 13.5284 11.5559 13.6283 11.5559 13.6559C11.5576 13.73 11.626 13.8506 11.6977 13.9092C11.7609 13.9609 11.7729 13.9626 11.9505 13.9678C12.1128 13.973 12.1469 13.9695 12.2118 13.9385C12.3792 13.8558 12.4219 13.7041 12.3604 13.4129C12.3092 13.17 12.3194 13.1321 12.4475 13.058C12.5825 12.9787 12.726 12.8391 12.7686 12.7443C12.8507 12.5634 12.7755 12.3584 12.5944 12.2636C12.55 12.2412 12.4954 12.2309 12.4151 12.2309C12.2904 12.2309 12.2101 12.2601 12.0632 12.3549L11.9795 12.4083L11.9266 12.3756C11.7097 12.2463 11.6704 12.2309 11.5388 12.2326C11.4449 12.2326 11.3937 12.2412 11.3475 12.2653Z" fill="currentColor"/>
            <path d="M7.2003 10.2647C6.89797 10.3612 6.6725 10.5852 6.55636 10.904C6.5 11.0557 6.47266 11.2952 6.49657 11.4244C6.55294 11.7329 6.80402 12.0137 7.08929 12.0913C7.44798 12.186 7.71614 12.124 7.95357 11.8862C8.09191 11.7501 8.16709 11.6312 8.24223 11.4382C8.29688 11.3021 8.3003 11.278 8.3003 11.085L8.302 10.8782L8.23028 10.73C8.11582 10.4956 7.90915 10.3216 7.67002 10.2578C7.53508 10.2234 7.31816 10.2251 7.2003 10.2647Z" fill="currentColor"/>
            <path d="M16.3231 10.2596C16.0891 10.3233 15.8808 10.4991 15.7697 10.73L15.698 10.8782L15.6997 11.085C15.6997 11.278 15.7031 11.3021 15.7578 11.4382C15.8329 11.6312 15.9081 11.7501 16.0464 11.8862C16.2839 12.124 16.552 12.186 16.9107 12.0913C17.1174 12.0361 17.3241 11.8604 17.4232 11.6553C17.5086 11.4813 17.529 11.3555 17.5017 11.1573C17.4385 10.7041 17.1755 10.375 16.7843 10.2596C16.6699 10.2251 16.4478 10.2251 16.3231 10.2596Z" fill="currentColor"/>
        </svg>

        <h2 class="card-title">Ollama (Local) Configuration</h2>
    </div>
 
    <div class="form-group">
        <label for="ollama-base-url">
            Base URL:
            <div class="tooltip">
                <svg class="tooltip-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M12 16v-4"></path>
                    <path d="M12 8h.01"></path>
                </svg>
                <span class="tooltip-text">The URL of your Ollama server. Default is http://localhost:11434</span>
            </div>
        </label>
        <div class="api-key-container">
            <input type="text" id="ollama-base-url" value="{{ollamaBaseURL}}" placeholder="http://localhost:11434" />
            <button id="connect-ollama" class="secondary-button" title="Connect to Ollama server">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M5 12h14"></path>
                    <path d="M12 5v14"></path>
                </svg>
                Connect
            </button>
        </div>
    </div>
    
    <div class="form-group">
        <label for="ollama-model">
            Model:
            <div class="tooltip">
                <svg class="tooltip-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M12 16v-4"></path>
                    <path d="M12 8h.01"></path>
                </svg>
                <span class="tooltip-text">Select a model from your local Ollama installation</span>
            </div>
        </label>
        <div class="model-select-container">
            <select id="ollama-model" {{#unless ollamaModels.length}}disabled{{/unless}}>
                {{#if ollamaModels.length}}
                    {{#each ollamaModels}}
                        <option value="{{this.name}}" {{#if (eq ../modelConfig.model this.name)}}selected{{/if}}>{{this.name}} ({{this.size}})</option>
                    {{/each}}
                {{else}}
                    <option value="">Loading models...</option>
                {{/if}}
            </select>
            <button id="refresh-ollama-models" class="secondary-button" title="Refresh model list">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 2v6h-6"></path>
                    <path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path>
                    <path d="M3 22v-6h6"></path>
                    <path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
                </svg>
            </button>
        </div>
        <div id="ollama-models-status" class="status-message" style="display: none;"></div>
    </div>
    
    <div class="form-group">
        <div class="model-details-container">
            <div class="model-details-header">Model Details</div>
            <div id="ollama-model-details" class="model-details">
                {{#if ollamaModels.length}}
                    <div class="model-detail-item">
                        <span class="detail-label">Parameter Size:</span>
                        <span class="detail-value" id="ollama-param-size">{{#with (lookup ollamaModels 0)}}{{this.parameterSize}}{{/with}}</span>
                    </div>
                    <div class="model-detail-item">
                        <span class="detail-label">Quantization:</span>
                        <span class="detail-value" id="ollama-quantization">{{#with (lookup ollamaModels 0)}}{{this.quantizationLevel}}{{/with}}</span>
                    </div>
                    <div class="model-detail-item">
                        <span class="detail-label">Size on Disk:</span>
                        <span class="detail-value" id="ollama-size">{{#with (lookup ollamaModels 0)}}{{this.size}}{{/with}}</span>
                    </div>
                {{else}}
                    <div class="model-detail-empty">Connect to Ollama to view model details</div>
                {{/if}}
            </div>
        </div>
    </div>
    
    <div class="form-group">
        <div class="action-buttons">
            <button id="pull-ollama-model" class="primary-button" title="Pull a new model from Ollama registry">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Pull New Model
            </button>
        </div>
    </div>
</div>

<style>
    .model-details-container {
        background-color: var(--vscode-editor-background);
        border: 1px solid var(--vscode-panel-border);
        border-radius: 4px;
        padding: 8px;
        margin-top: 8px;
    }
    
    .model-details-header {
        font-weight: bold;
        margin-bottom: 8px;
        color: var(--vscode-editor-foreground);
    }
    
    .model-details {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .model-detail-item {
        display: flex;
        justify-content: space-between;
    }
    
    .detail-label {
        color: var(--vscode-descriptionForeground);
    }
    
    .detail-value {
        font-family: var(--vscode-editor-font-family);
    }
    
    .model-detail-empty {
        color: var(--vscode-descriptionForeground);
        font-style: italic;
        text-align: center;
        padding: 8px 0;
    }
    
    .action-buttons {
        display: flex;
        gap: 8px;
        margin-top: 8px;
    }
</style>